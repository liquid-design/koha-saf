# ============================================================================
# ROLE: koha_config
# ----------------------------------------------------------------------------
# Verantwoordelijkheid:
# Past technische Koha configuratie toe na instance creatie.
#
# Doet wel:
# - beheren van koha-conf.xml
# - instellen van technische parameters
#
# Doet niet:
# - business instellingen
# - data-initialisatie
# ============================================================================

- name: Assert Koha instance facts exist
  assert:
    that:
      - ansible_local.koha is defined
      - ansible_local.koha.instance is defined
      - ansible_local.koha.instance == koha_instance
      - ansible_local.koha.db_name is defined
      - ansible_local.koha.db_user is defined
      - ansible_local.koha.db_pass is defined
    fail_msg: "Koha runtime facts are missing or inconsistent; instance not initialized yet"

- name: Set Koha DB vars from persistent facts
  set_fact:
    koha_db_name: "{{ ansible_local.koha.db_name }}"
    koha_db_user: "{{ ansible_local.koha.db_user }}"
    koha_db_pass: "{{ ansible_local.koha.db_pass }}"
  no_log: true